<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Waldo</title>
  </head>
  <body>
    <h1>Waldo Time Tracker</h1>

    <div class="stat-box">
      <div class="label">Current Session</div>
      <div class="value" id="timeDisplay">0s</div>
    </div>

    <div class="stat-box">
      <div class="label">Today's Total</div>
      <div class="value" id="todayDisplay">0s</div>
    </div>

    <div class="stat-box">
      <div class="label">Idle Time</div>
      <div class="value" id="idleDisplay">0s</div>
    </div>

    <div class="button-container">
      <button class="button" id="toggleButton">
        <i class="codicon codicon-play"></i>
        <span id="toggleButtonText">Start Timer</span>
      </button>

      <button class="button secondary" id="statsButton">
        <i class="codicon codicon-graph"></i>
        Show Statistics
      </button>

      <button class="button danger" id="resetButton">
        <i class="codicon codicon-clear-all"></i>
        Reset Timer
      </button>
    </div>

    <p class="status" id="statusDisplay">Timer stopped</p>

    <script>
      const vscode = acquireVsCodeApi();

      document.getElementById("toggleButton").addEventListener("click", () => {
        const isRunning = document
          .getElementById("statusDisplay")
          .classList.contains("running");
        vscode.postMessage({
          command: isRunning ? "stopTimer" : "startTimer",
        });
      });

      document.getElementById("resetButton").addEventListener("click", () => {
        vscode.postMessage({ command: "resetTimer" });
      });

      document.getElementById("statsButton").addEventListener("click", () => {
        vscode.postMessage({ command: "showStats" });
      });

      window.addEventListener("message", (event) => {
        const message = event.data;
        if (message.type === "update-time") {
          document.getElementById("timeDisplay").textContent = message.time;
          document.getElementById("todayDisplay").textContent =
            message.todayTotal;
          document.getElementById("idleDisplay").textContent =
            message.idleTime + "s";

          const statusEl = document.getElementById("statusDisplay");
          const toggleBtn = document.getElementById("toggleButton");
          const toggleBtnText = document.getElementById("toggleButtonText");
          const toggleBtnIcon = toggleBtn.querySelector(".codicon");
          const resetBtn = document.querySelector(".button.danger");

          statusEl.textContent = message.isTracking
            ? "Timer running..."
            : "Timer stopped";
          statusEl.className =
            "status " + (message.isTracking ? "running" : "");

          toggleBtnText.textContent = message.isTracking
            ? "Stop Timer"
            : "Start Timer";
          toggleBtnIcon.className =
            "codicon " + (message.isTracking ? "codicon-stop" : "codicon-play");

          resetBtn.disabled = message.isTracking;
        }
      });
    </script>
  </body>
</html>
