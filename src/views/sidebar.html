<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Waldo</title>
    <style>
      body {
        font-family: var(--vscode-font-family);
        padding: 10px;
        color: var(--vscode-foreground);
        background-color: var(--vscode-editor-background);
      }
      h1 {
        color: var(--vscode-textLink-foreground);
        font-size: 16px;
        margin-bottom: 16px;
      }
      .stat-box {
        background-color: var(--vscode-editor-inactiveSelectionBackground);
        padding: 10px;
        margin: 5px 0;
        border-radius: 4px;
      }
      .label {
        font-size: 12px;
        color: var(--vscode-descriptionForeground);
      }
      .value {
        font-size: 14px;
        font-weight: bold;
        color: var(--vscode-textLink-activeForeground);
      }
      .status {
        margin-top: 8px;
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 4px;
        background-color: var(--vscode-statusBarItem-warningBackground);
        display: inline-block;
      }
      .running {
        background-color: var(--vscode-statusBarItem-prominentBackground);
      }
      .button-container {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 16px;
      }
      .button {
        background-color: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        gap: 6px;
      }
      .button:hover {
        background-color: var(--vscode-button-hoverBackground);
      }
      .button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .button.secondary {
        background-color: var(--vscode-button-secondaryBackground);
        color: var(--vscode-button-secondaryForeground);
      }
      .button.secondary:hover {
        background-color: var(--vscode-button-secondaryHoverBackground);
      }
      .button.danger {
        background-color: var(--vscode-errorForeground);
      }
      .button.danger:hover {
        opacity: 0.8;
      }
      .codicon {
        font-family: "codicon" !important;
        font-size: 16px;
        line-height: 16px;
      }
    </style>
  </head>
  <body>
    <h1>Waldo Time Tracker</h1>

    <div class="stat-box">
      <div class="label">Current Session</div>
      <div class="value" id="timeDisplay">0s</div>
    </div>

    <div class="stat-box">
      <div class="label">Today's Total</div>
      <div class="value" id="todayDisplay">0s</div>
    </div>

    <div class="stat-box">
      <div class="label">Idle Time</div>
      <div class="value" id="idleDisplay">0s</div>
    </div>

    <div class="button-container">
      <button class="button" id="toggleButton">
        <i class="codicon codicon-play"></i>
        <span id="toggleButtonText">Start Timer</span>
      </button>

      <button class="button secondary" id="statsButton">
        <i class="codicon codicon-graph"></i>
        Show Statistics
      </button>

      <button class="button danger" id="resetButton">
        <i class="codicon codicon-clear-all"></i>
        Reset Timer
      </button>
    </div>

    <p class="status" id="statusDisplay">Timer stopped</p>

    <script>
      const vscode = acquireVsCodeApi();

      document.getElementById("toggleButton").addEventListener("click", () => {
        const isRunning = document
          .getElementById("statusDisplay")
          .classList.contains("running");
        vscode.postMessage({
          command: isRunning ? "stopTimer" : "startTimer",
        });
      });

      document.getElementById("resetButton").addEventListener("click", () => {
        vscode.postMessage({ command: "resetTimer" });
      });

      document.getElementById("statsButton").addEventListener("click", () => {
        vscode.postMessage({ command: "showStats" });
      });

      window.addEventListener("message", (event) => {
        const message = event.data;
        if (message.type === "update-time") {
          document.getElementById("timeDisplay").textContent = message.time;
          document.getElementById("todayDisplay").textContent =
            message.todayTotal;
          document.getElementById("idleDisplay").textContent =
            message.idleTime + "s";

          const statusEl = document.getElementById("statusDisplay");
          const toggleBtn = document.getElementById("toggleButton");
          const toggleBtnText = document.getElementById("toggleButtonText");
          const toggleBtnIcon = toggleBtn.querySelector(".codicon");
          const resetBtn = document.querySelector(".button.danger");

          statusEl.textContent = message.isTracking
            ? "Timer running..."
            : "Timer stopped";
          statusEl.className =
            "status " + (message.isTracking ? "running" : "");

          toggleBtnText.textContent = message.isTracking
            ? "Stop Timer"
            : "Start Timer";
          toggleBtnIcon.className =
            "codicon " + (message.isTracking ? "codicon-stop" : "codicon-play");

          resetBtn.disabled = message.isTracking;
        }
      });
    </script>
  </body>
</html>
